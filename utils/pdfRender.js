export function renderHtml(e,t){const l=e=>{const t={},l=e.match(/style=["']([^"']*(?:(?!["']).)*?)["']/i);l&&(t.style=(e=>{const t={};return e?(e.split(";").filter(e=>e.trim()).forEach(e=>{const[l,s]=e.split(":").map(e=>e.trim());l&&s&&(t[l.toLowerCase()]=s)}),t):t})(l[1]));const s=e.match(/color=["']([^"']+)["']/i);return s&&(t.color=s[1]),t},s=e=>{const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null},o=(e,t)=>{if(t)if(t.startsWith("#")){const l=s(t);l&&e.fillColor(l)}else if(t.startsWith("rgb")){const l=t.match(/\d+/g);l&&l.length>=3&&e.fillColor([parseInt(l[0]),parseInt(l[1]),parseInt(l[2])])}else{const l={black:"#000000",white:"#FFFFFF",red:"#FF0000",green:"#008000",blue:"#0000FF",yellow:"#FFFF00",cyan:"#00FFFF",magenta:"#FF00FF",gray:"#808080",grey:"#808080",orange:"#FFA500",purple:"#800080",pink:"#FFC0CB",brown:"#A52A2A",navy:"#000080"}[t.toLowerCase()];if(l){const t=s(l);t&&e.fillColor(t)}}},i={font:"Helvetica",size:12,color:"black",align:"left",continued:!1,listLevel:0,listType:"bullet"},n=[],a=[],r=[],c=[],f=t.split(/(<[^>]+>)/);for(let t=0;t<f.length;t++){const s=f[t];if(s.startsWith("<")&&s.endsWith(">")){const t=s.toLowerCase(),f=l(s);if(t.startsWith("</"))"</b>"===t||"</strong>"===t||"</i>"===t||"</em>"===t?(i.font=n.pop()||"Helvetica",i.color=r.pop()||"black",i.size=a.pop()||12,e.fillColor(i.color),e.font(i.font,i.size)):"</u>"===t||("</span>"===t||"</font>"===t?(i.color=r.pop()||"black",i.size=a.pop()||12,i.font=n.pop()||"Helvetica",e.fillColor(i.color),e.font(i.font,i.size)):"</p>"===t||t.match(/<\/(h[1-6]|div)>/)?(e.text("",{continued:!1}),e.moveDown(.5),i.size=a.pop()||12,i.align=c.pop()||"left",e.font(i.font,i.size)):"</ul>"===t||"</ol>"===t?(i.listLevel--,e.moveDown(.3)):"</li>"===t&&e.text("",{continued:!1}));else if("<b>"===t||t.startsWith("<b ")||"<strong>"===t||t.startsWith("<strong ")){if(n.push(i.font),r.push(i.color),a.push(i.size),i.font="Helvetica-Bold",f.style?.color&&(i.color=f.style.color,o(e,i.color)),f.style?.["font-size"]){const e=f.style["font-size"].match(/(\d+)/);e&&(i.size=parseInt(e[1]))}e.font(i.font,i.size)}else if("<i>"===t||t.startsWith("<i ")||"<em>"===t||t.startsWith("<em ")){if(n.push(i.font),r.push(i.color),a.push(i.size),i.font="Helvetica-Oblique",f.style?.color&&(i.color=f.style.color,o(e,i.color)),f.style?.["font-size"]){const e=f.style["font-size"].match(/(\d+)/);e&&(i.size=parseInt(e[1]))}e.font(i.font,i.size)}else if("<u>"===t);else if("<br>"===t||"<br/>"===t)e.text("",{continued:!1}),e.moveDown(.3);else if(t.startsWith("<h1"))a.push(i.size),c.push(i.align),i.size=24,f.style?.["text-align"]&&(i.align=f.style["text-align"]),e.moveDown(.5),e.font(i.font,i.size);else if(t.startsWith("<h2"))a.push(i.size),c.push(i.align),i.size=20,f.style?.["text-align"]&&(i.align=f.style["text-align"]),e.moveDown(.4),e.font(i.font,i.size);else if(t.startsWith("<h3"))a.push(i.size),c.push(i.align),i.size=18,f.style?.["text-align"]&&(i.align=f.style["text-align"]),e.moveDown(.3),e.font(i.font,i.size);else if(t.startsWith("<h4"))a.push(i.size),c.push(i.align),i.size=16,f.style?.["text-align"]&&(i.align=f.style["text-align"]),e.font(i.font,i.size);else if(t.startsWith("<h5"))a.push(i.size),c.push(i.align),i.size=14,f.style?.["text-align"]&&(i.align=f.style["text-align"]),e.font(i.font,i.size);else if(t.startsWith("<h6"))a.push(i.size),c.push(i.align),i.size=13,f.style?.["text-align"]&&(i.align=f.style["text-align"]),e.font(i.font,i.size);else if(t.startsWith("<p")){if(e.text("",{continued:!1}),e.moveDown(.3),a.push(i.size),c.push(i.align),f.style?.["text-align"]&&(i.align=f.style["text-align"]),f.style?.["font-size"]){const e=f.style["font-size"].match(/(\d+)/);e&&(i.size=parseInt(e[1]))}}else if(t.startsWith("<div")){if(a.push(i.size),c.push(i.align),f.style?.["text-align"]&&(i.align=f.style["text-align"]),f.style?.["font-size"]){const e=f.style["font-size"].match(/(\d+)/);e&&(i.size=parseInt(e[1]))}e.moveDown(.2)}else if(t.startsWith("<span")||t.startsWith("<font")){if(r.push(i.color),a.push(i.size),n.push(i.font),f.style?.color?(i.color=f.style.color,o(e,i.color)):f.color&&(i.color=f.color,o(e,i.color)),f.style?.["font-size"]){const e=f.style["font-size"].match(/(\d+)/);e&&(i.size=parseInt(e[1]))}if(f.style?.["font-weight"]){const e=f.style["font-weight"];"bold"===e||"700"===e||parseInt(e)>=600?i.font="Helvetica-Bold":("normal"===e||"400"===e||parseInt(e)<600)&&(i.font="Helvetica")}"italic"===f.style?.["font-style"]&&(i.font="Helvetica-Bold"===i.font?"Helvetica-BoldOblique":"Helvetica-Oblique"),e.font(i.font,i.size)}else if("<ul>"===t)i.listLevel++,i.listType="bullet",e.moveDown(.3);else if("<ol>"===t)i.listLevel++,i.listType="number",e.moveDown(.3);else if("<li>"===t){const t=20*i.listLevel;e.text("",{continued:!1}),"bullet"===i.listType?e.text("• ",{indent:t,continued:!0}):e.text("- ",{indent:t,continued:!0})}}else if(s.trim()){const t={continued:!0,align:i.align};let l=s.replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&ldquo;/g,'"').replace(/&rdquo;/g,'"').replace(/&lsquo;/g,"'").replace(/&rsquo;/g,"'").replace(/&ndash;/g,"–").replace(/&mdash;/g,"—").replace(/&hellip;/g,"…").replace(/&copy;/g,"©").replace(/&reg;/g,"®").replace(/&trade;/g,"™").replace(/&euro;/g,"€").replace(/&pound;/g,"£").replace(/&yen;/g,"¥");e.text(l,t)}}e.text("",{continued:!1}),e.fillColor("black")}