import Group from"./group.model.js";import{requireAuth}from"../../middleware/auth.js";const groupResolvers={Query:{groups:async(e,t,s)=>{try{const e=requireAuth(s),t=e?.school[0].id;return await Group.find({is_deleted:!1,school:t}).sort({createdAt:-1}).exec()||[]}catch(e){return{status:400,type:"error",message:`Failed to fetch groups: ${e?.message||"Unknown error"}`}}},getGroupById:async(e,t,s)=>{try{const e=requireAuth(s),r=(e?.school[0].id,await Group.findById(t.id).exec());return r||{status:400,type:"error",message:`Group with ID ${t.id} not found`}}catch(e){return{status:400,type:"error",message:`Failed to fetch group: ${e?.message||"Unknown error"}`}}}},Mutation:{addGroup:async(e,t,s)=>{try{const e=requireAuth(s),r=e?.school[0].id,{data:a}=t;if(await Group.findOne({name:a.name,is_deleted:!1,school:r}).exec())return{status:400,type:"error",message:"Group with this name already exists"};!0===a.is_default&&await Group.updateMany({is_default:!0,is_deleted:!1,school:r},{is_default:!1}).exec(),a.school=r;const u=new Group(a);return await u.save(),{status:200,type:"success",message:"Group created successfully",data:u}}catch(e){return{status:400,type:"error",message:`Failed to create group: ${e?.message||"Unknown error"}`}}},updateGroup:async(e,t,s)=>{try{requireAuth(s);const e=await Group.findByIdAndUpdate(t.id,{$set:t.data},{new:!0,runValidators:!0});return e?{status:200,type:"success",message:"Group updated successfully",data:e}:{status:400,type:"error",message:`Group with ID ${t.id} not found`}}catch(e){return{status:400,type:"error",message:`Failed to update group: ${e.message}`}}},deleteGroup:async(e,t,s)=>{try{requireAuth(s);return await Group.findByIdAndDelete(t.id)?{status:200,type:"success",message:"Group deleted successfully"}:{status:400,type:"error",message:`Group with ID ${t.id} not found`}}catch(e){return{status:400,type:"error",message:`Failed to delete group: ${e.message}`}}},deleteMultipleGroups:async(e,t,s)=>{try{const e=requireAuth(s),r=(e?.school[0].id,await Group.deleteMany({_id:{$in:t.data}}));return 0===r.deletedCount?{status:400,type:"error",message:"No groups found to delete"}:{status:200,type:"success",message:`${r.deletedCount} group(s) deleted successfully`}}catch(e){return{status:400,type:"error",message:`Failed to delete groups: ${e.message}`}}}}};export default groupResolvers;